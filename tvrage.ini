[script]
n0=;*** TVRage - "Original" code by Gecko321 (www.mirc.net/projects.php?go=1204694830) *** SRU EDiT - Downloaded from: http://www.hawkee.com/snippet/9506/
n1=on *:LOAD:dialog -m TVSettings TVSettings -4
n2=on *:UNLOAD:.unset %TV_*
n3=menu Channel,Status,Menubar,Query {
n4=  -
n5=  $iif(%TV_Rage = 1,$style(1)) TVRage $+($chr(40),$iif(%TV_Rage = 1,Enabled,Disabled),$chr(41))
n6=  .Settings:dialog -m TVSettings TVSettings -4
n7=  .Self Search:dialog -m SelfSearch SelfSearch -4
n8=  .-
n9=  .Turn $iif(%TV_Rage != 1,on,off) :$iif(%TV_Rage != 1,%TV_Rage = 1,%TV_Rage = 0) | $iif(!%TV_Where,%TV_Where = 1) | $iif(!%TV_Where2,%TV_Where2 = 0) | $iif(!%TV_Color,%TV_Color = 1) | echo -at 14TVRage Has been $iif(%TV_Rage = 1,9enabled,4disabled)
n10=  -
n11=}
n12=on *:TEXT:*:#: { if ($left($strip($1),1) == !) || ($left($strip($1),1) == .) || ($left($strip($1),1) == @) && (($mid($strip($1),2,4) == SHOW && $len($strip($1)) == 5) || ($mid($strip($1),2,5) == TODAY && $len($strip($1)) == 6) || ($mid($strip($1),2,8) == TOMORROW && $len($strip($1)) == 9) || ($mid($strip($1),2,2) == TV && $len($strip($1)) == 3) || ($mid($strip($1),2,2) == EP && $len($strip($1)) == 3) || ($mid($strip($1),2,1) == N && $len($strip($1)) == 2) || ($mid($strip($1),2,1) == L && $len($strip($1)) == 2)) && (!$timer($+(SPAM,$network,$nick))) { .timer $+ $+(SPAM,$network,$nick) 1 3 noop | mTVRage $strip($1-) } }
n13=on *:INPUT:#: {
n14=  if ($left($strip($1),1) == !) || ($left($strip($1),1) == .) || ($left($strip($1),1) == @) && (($mid($strip($1),2,4) == SHOW && $len($strip($1)) == 5) || ($mid($strip($1),2,5) == TODAY && $len($strip($1)) == 6) || ($mid($strip($1),2,8) == TOMORROW && $len($strip($1)) == 9) || ($mid($strip($1),2,2) == TV && $len($strip($1)) == 3) || ($mid($strip($1),2,2) == EP && $len($strip($1)) == 3) || ($mid($strip($1),2,1) == N && $len($strip($1)) == 2) || ($mid($strip($1),2,1) == L && $len($strip($1)) == 2)) && (%TV_Rage == 1) { var %num = $trnum
n15=    if ($2 = Schedule) { set %TVRage_Target. [ $+ [ %num ] ] $iif(%TV_Where2 = 1,$me,$Target) }
n16=    elseif ($Target !ischan) { set %TVRage_Target. [ $+ [ %num ] ] $me | set %TVRage_Query. [ $+ [ %num ] ] 1 }
n17=    else { set %TVRage_Target. [ $+ [ %num ] ] $iif(%TV_Where = 1,$Target,$me) }
n18=    set %TVRage_Chan. [ $+ [ %num ] ] $chan | set %TVRage_Nick. [ $+ [ %num ] ] $me
n19=    TVRage.Load %num $1-
n20=  } 
n21=}
n22=alias mTVRage { 
n23=  ;*** Not turned on
n24=  if (%TV_Rage == 0) { halt }
n25=  ;************************************************************
n26=  var %num = $trnum | set -u17 %TVRage_TargetC. [ $+ [ %num ] ] # | set %TVRage_Nick. [ $+ [ %num ] ] $nick | set %TVRage_Chan. [ $+ [ %num ] ] $chan
n27=  ;************************************************************************************************************************************
n28=  if ($Target !ischan) || ($2 == Schedule) || ($mid($strip($1),2,5) == TODAY) || ($mid($strip($1),2,8) == TOMORROW) || (Trigger isin $1-2) { set %TVRage_Target. [ $+ [ %num ] ] $nick | set %TVRage_Query. [ $+ [ %num ] ] 1 }
n29=  else { set -u17 %TVRage_Target. [ $+ [ %num ] ] $iif(%TV_Where = 1,$chan,$nick) }
n30=  ;************************************************************************************************************************************
n31=  ;*** !TV TRiGGER / CMDS / HELP / COMMANDs
n32=  if (($2 = TRIGGERs) || ($2 == CMDS) || ($2 == HELP) || ($2 == COMMANDs)) && (!$3) { var %X $r(1,2), %O $left($strip($1),1) | var %Y $iif($r(1,2) == 1,Dexter,$iif($r(1,2) == 1,House,$iif($r(1,2) == 1,Black Books,$iif($r(1,2) == 1,Blue Mountain State,$iif($r(1,2) == 1,Ideal,$iif($r(1,2) == 1,Community,$iif($r(1,2) == 1,The IT Crowd,$iif($r(1,2) == 1,My Name is Earl,$iif($r(1,2) == 1,Chuck,$iif($r(1,2) == 1,FlashForward,$iif($r(1,2) == 1,White Collar,$iif($r(1,2) == 1,Heroes,$iif($r(1,2) == 1,MythBusters,$iif($r(1,2) == 1,Top Gear,$iif($r(1,2) == 1,Psych,$iif($r(1,2) == 1,Breaking Bad,$iif($r(1,2) == 1,Weeds,$iif($r(1,2) == 1,HiMYM,How I Met Your Mother)))))))))))))))))) | var %Z $iif($r(1,2) == 1,Black Books,$iif($r(1,2) == 1,Blue Mountain State,$iif($r(1,2) == 1,Community,$iif($r(1,2) == 1,Ideal,$iif($r(1,2) == 1,Dexter,$iif($r(1,2) == 1,House,$iif($r(1,2) == 1,The IT Crowd,$iif($r(1,2) == 1,My Name is Earl,$iif($r(1,2) == 1,Chuck,$iif($r(1,2) == 1,FlashForward,$iif($r(1,2) == 1,White Collar,$iif($r(1,2) == 1,Heroes,$iif($r(1,2) == 1,MythBusters,$iif($r(1,2) == 1,Top Gear,$iif($r(1,2) == 1,Psych,$iif($r(1,2) == 1,Breaking Bad,$iif($r(1,2) == 1,Weeds,$iif($r(1,2) == 1,HiMYM,How I Met Your Mother)))))))))))))))))) | var %C $iif($r(1,2) == 1,Ideal,$iif($r(1,2) == 1,The IT Crowd,$iif($r(1,2) == 1,My Name is Earl,$iif($r(1,2) == 1,Chuck,$iif($r(1,2) == 1,FlashForward,$iif($r(1,2) == 1,White Collar,$iif($r(1,2) == 1,Heroes,$iif($r(1,2) == 1,MythBusters,$iif($r(1,2) == 1,Top Gear,$iif($r(1,2) == 1,Psych,$iif($r(1,2) == 1,Breaking Bad,$iif($r(1,2) == 1,Dexter,$iif($r(1,2) == 1,House,$iif($r(1,2) == 1,Black Books,$iif($r(1,2) == 1,Blue Mountain State,$iif($r(1,2) == 1,Community,$iif($r(1,2) == 1,Weeds,$iif($r(1,2) == 1,HiMYM,How I Met Your Mother)))))))))))))))))) | msg %TVRage_Target. [ $+ [ %num ] ] 4- $+(3,%O,SHOW) 4<3Show4> 5EX: $+(%O,SHOW) %Y 15ooO( Get show description 15) | msg %TVRage_Target. [ $+ [ %num ] ] 4- $+(3,$iif(%X == 1,$+(%O,NEXT) 15/ $+(3,%O,LAST),$+(,%O,N) 15/ $+(3,%O,L)) 4<3Show4>) 5EX: $iif(%X == 1,$+(%O,NEXT) %Z 15/ $+(%O,LAST),$+(%O,N) %Z 15/ $+(%O,L)) %Z 15ooO( Get information for next 15/ last episode 15) | msg %TVRage_Target. [ $+ [ %num ] ] 4- $+(3,$iif($1 == $+(%O,EP),$v2,$+(%O,TV))) 4<3Show4> (3Season and Episode4) 5EX: $iif($1 == $+(%O,EP),$v2,$+(%O,TV)) %C $+($r(1,3),x0,$r(1,5)) 15ooO( Get general show information and episode summary (if season and episode is given) 15) | msg %TVRage_Target. [ $+ [ %num ] ] 4- $+(3,$iif($1 == !EP,$v2,!TV)) Schedule 4<3Day of Week4> (3Time4) (3Country4) 5EX: $iif($1 == !EP,$v2,!TV) Schedule Fri 10 $iif(%X == 1,GB,$iif(%X == 1,UK,AU)) 5Country: 3GB14, 3UK 14and 3AU (4US by default) 15ooO( Get program schedule for the requested day (Time and/or Country) 15) | msg %TVRage_Target. [ $+ [ %num ] ] 4- 4NOTE: Options in 4( ) are optional... and options in 4< > are required. | .unset %Y %Z %C %TVRage* [ $+ [ %num ] ] | halt }
n33=  ;************************************************************************************************************************************
n34=  ;*** !N / !NEXT
n35=  elseif ($1 == !N) || ($1 == !NEXT) { set -u17 %TVRage_ONLY. [ $+ [ %num ] ] NEXT }
n36=  ;*** !L / !LAST
n37=  elseif ($1 == !L) || ($1 == !LAST) { set -u17 %TVRage_ONLY. [ $+ [ %num ] ] LAST }
n38=  ;*** !SHOW / !SUMMARY
n39=  elseif ($1 == !SHOW) { set -u17 %TVRage_ONLY. [ $+ [ %num ] ] SHOW }
n40=  ;*** !TODAY / !TOMORROW
n41=  elseif ($1 == !TODAY) || ($1 == !TOMORROW) { set %TVRage_Schedule. [ $+ [ %num ] ] !TV Schedule $remove($1-,!) }
n42=  ;************************************************************************************************************************************
n43=  TVRage.Load %num $iif(%TVRage_Schedule. [ $+ [ %num ] ],$v1,$replace($1-,BMS,Blue Mountain State,HiMYM,How I Met Your Mother,TUT,The Ultimate Fighter,DH,Desperate Housewives,A23,Don't Trust the B---- in Apartment 23))
n44=}
n45=alias -l TVRage.Load { var %num = $1
n46=  if ($3 == Schedule) { set %TVRage_Type. [ $+ [ %num ] ] $v1
n47=    var %temp $GetTok($2-,$numtok($2-,32),32)
n48=    if ((%Temp = GB) || (%Temp = UK) || (%Temp = US) || (%Temp = AU)) { set %TVRage_Country. [ $+ [ %num ] ] $v1 | set %TVRage_Type. [ $+ [ %num ] ] Country }
n49=    set %TVRage_Time_Schedule. [ $+ [ %num ] ] $iif($5 !isnum,$null,$Int($5)) | set %TVRage_Date. [ $+ [ %num ] ] $FullDate($4)
n50=    if (%TVRage_Date. [ $+ [ %num ] ] = $null) { msg %TVRage_Target. [ $+ [ %num ] ] You need to pick a 4Day of the Week $iif(!%TVRage_Country. [ $+ [ %num ] ],or 4Country) | unset %TVRage_*. [ $+ [ %num ] ] %Check_*. [ $+ [ %num ] ] }
n51=    TVRage %Num Schedule
n52=  }
n53=  else { $iif($CheckEP(%num,$3-) = 1,set %TVRage_Type. [ $+ [ %num ] ] EPSpec,$iif($2 == !SHOW,set %TVRage_Type. [ $+ [ %num ] ] SHOW,set %TVRage_Type. [ $+ [ %num ] ] Ep)) | TVRage %num $3- }
n54=}
n55=alias -l TVRage { 
n56=  if ((%TVRage_Type. [ $+ [ $1 ] ] != Schedule) && (!$2)) { msg %TVRage_Target. [ $+ [ $1 ] ] Hmmm... you actually need to search for a TV-Show you know! 5Type: !TV Triggers 5for more help | .unset %TVRage_*. [ $+ [ $1 ] ] | return }
n57=  elseif (%TVRage_Type. [ $+ [ $1 ] ] = EPSpec) { %tvshow. [ $+ [ $1 ] ] = $+($replace($GetTok($2-,1- [ $Calc($numtok($2-,32)-1) ] ,32),$chr(32),% $+ 20),&ep=,%Check_Season. [ $+ [ $1 ] ],x,%Check_EP. [ $+ [ $1 ] ]) }
n58=  else { %TVShow. [ $+ [ $1 ] ] = $replace($2-,$chr(32),% $+ 20) }
n59=  sockopen TVRage. [ $+ [ $1 ] ] services.tvrage.com 80
n60=}
n61=;*** BetterDuration (renamed LongTime+ here) *** Downloaded from: http://www.nealirc.org/IRC/mIRC.html
n62=alias LongTime+ { var %lifeseconds = $abs($1) | var %age, %years, %days, %hours, %minutes, %seconds, %temp | %years = $int($calc(%lifeseconds / 31557600)) | if (%years != 0) { %age = $+(15,%years,14year,$iif(%years > 1,s)) } | %temp = $calc(%lifeseconds - (%years * 31557600)) | %days = $int($calc(%temp / 86400)) | if (%days != 0) { %age = %age $+(15,%days,14day,$iif(%days > 1,s)) } | %temp = $calc(%temp - (%days * 86400)) | %hours = $int($calc(%temp / 3600)) | if (%hours != 0) { %age = %age $+(15,%hours,14hour,$iif(%hours > 1,s)) } | %temp = $calc(%temp - (%hours * 3600)) | %minutes = $int($calc(%temp / 60)) | if (%minutes != 0) { %age = %age $+(15,%minutes,14minute,$iif(%minutes > 1,s)) } | %seconds = $calc(%temp % 60) | if (%seconds != 0) { %age = %age $+(15,%seconds,14second,$iif(%seconds > 1,s)) } | return $iif($right(%age, 1) == $chr(44),$left(%age, -1),%age) }
n63=;*****************************************************************************************************************************************************************************************************************************************************************
n64=alias replaceLiNK { return $replace($remove($1,	),Ã??Ã?Â©,Ã?Â©,&aring;,Ã?Â¥,&#39;,',&quot;,",&amp,&,&#x27;,',&#39;,',&ndash;,Ã¢??,&middot;,Ã?Â·,&raquo;,Ã?Â»,&laquo;,Ã?Â«,&Uuml;,Ã??,&uuml;,Ã?Â¼,&Aacute;,Ã?Â,&aacute;,Ã?Â¡,&Eacute;,Ã??,&eacute;,Ã?Â©,&Iacute;,Ã?Â,&iacute;,Ã?Â­,&Oacute;,Ã??,&oacute;,Ã?Â³,&Ntilde;,Ã??,&ntilde;,Ã?Â±,&Uacute;,Ã??,&uacute;,Ã?Âº,&nbsp;,$chr(32),&#8221;,Ã¢?Â,&#8220;,Ã¢??,#8220;,Ã¢??,#8221;,Ã¢?Â,&#230;,Ã?Â¦,&#229;,Ã?Â¥,&#197;,Ã??,&#248;,Ã?Â¸,&#216;,Ã??,Ã?Â¢Ã¢?Â¬Ã¢?Â+a,$+($chr(32),Ã¢??,$chr(32)),Ã?Â¢Ã¢?Â¬Ã¢?Â,$chr(32),Ã??Ã?Â¡,Ã?Â¡,Ã??Ã?Â®,Ã?Â®,Ã?Â¢Ã¢??Ã?Â¢,Ã¢?Â¢,Ã??Ã?Â©,Ã?Â©,&#xE5;,Ã?Â¥,&#8230;,Ã¢?Â¦,&mdash;,-,&#039;,',&#8216;,Ã¢??,Ã??Ã¢?Â°,Ã??,&#34;,",&#8217;,',&#8211;,-,Ã??Ã?Â©,Ã?Â©,&aelig;,Ã?Â¦,&quot;,",Ã??Ã?Â¦,Ã?Â¦, Ã??Ã?Â¸ ,Ã?Â¸,Ã??Ã?Â¥,Ã?Â¥,Ã??Ã¢? ,Ã??,Ã??Ã??,Ã??,Ã??,Ã??,&#39;,',Ã?Â¢Ã¢?Â¬Ã¢?Â¢,',188.114.142.12,HiDDEN,&apos;,',#8217;,Ã¢??,&micro;,Ã?Â³,#8211;,-,&oslash;,Ã?Â¸,&#8212;,a,Ã?Â¢Ã¢?Â¬Ã??,Ã¢??,Ã??Ã?Â¤,Ã?Â¤,-&#160;,-,&#8242;,',Ã??Ã?Â¼,Ã?Â¼,Ã??Ã?Â©,Ã?Â©,Ã??Ã?Â©,Ã?Â©,Ã??Ã?Â¶,Ã?Â¶,&#252;,Ã?Â¼,&#198;,Ã??,Ã??Ã¢?Â¦,Ã??,&#233;,Ã?Â©,\u0027,',Ã?Â¢Ã¢?Â¬Ã??,Ã¢??,Ã?Â¢Ã¢?Â¬,Ã¢?Â,&#38;,&,|,|) }
n65=alias -l trnum { var %trnum $base($calc($base(%trnum,36,10) +1),10,36) | return %trnum }
n66=alias -l noHTML { var %x, %i = $regsub($1-,/(^[^<]*>|<[^>]*>|<[^>]*$)/g,$null,%x), %x = $remove(%x,	,&nbsp;) | return %x }
n67=alias -l LongTime { return $+(15,$replacex($1,wks,14weeks15,wk,14week15,days,14days15,day,14day15,hrs,14hours15,hr,14hour15,mins,14minutes15,min,14minute15,sec,14second),14) }
n68=alias -l FullDate { return $iif($Mid($1,1,3) == Tom,$replacex($day,Sun,Mon,Mon,Tues,Tues,Wednes,Wednes,Thurs,Thurs,Fri,Fri,Satur,Satur,Sun),$iif($Mid($1,1,3) == Yes,$replace($day,Mon,Sun,Tues,Mon,Wednes,Tues,Thurs,Wednes,Fri,Thurs,Satur,Fri,Sun,Satur),$iif($Mid($1,1,3) == Tod,$day,$iif($Mid($1,1,3) == Mon,Monday,$iif($Mid($1,1,3) == Tue,Tuesday,$iif($Mid($1,1,3) == Wed,Wednesday,$iif($Mid($1,1,3) == Thu,Thursday,$iif($Mid($1,1,3) == Fri,Friday,$iif($Mid($1,1,3) == Sat,Saturday,$iif($Mid($1,1,3) == Sun,Sunday,$null)))))))))) }
n69=alias -l SetMonth { return $replace($1,Jan,1,Feb,2,Mar,3,Apr,4,May,5,Jun,6,Jul,7,Aug,8,Sep,9,Oct,10,Nov,11,Dec,12) }
n70=;*** Text Overflow Limiting *** Downloaded from: http://www.hawkee.com/snippet/7305/
n71=alias mCuttext { var %ch $1,%str $2-,%max $calc(498 - $len(%ch) - $len($address($me,5)))
n72=  while (%str) { var %cut $limtok(%str,%max,32) | msg %ch %cut | var %str $gettok(%str,$+($calc($numtok(%cut,32) + 1),-),32) }
n73=}
n74=alias mCuttextN { var %ch $1,%str $2-,%max $calc(498 - $len(%ch) - $len($address($me,5)))
n75=  while (%str) { var %cut $limtok(%str,%max,32) | .notice %ch %cut | var %str $gettok(%str,$+($calc($numtok(%cut,32) + 1),-),32) }
n76=}
n77=alias limtok { if ($len($gettok($1,1,$3)) >= $2) { return $left($1,$2) } | var %x 1,%str,%c | while ($gettok($1,%x,$$3)) { var %c $v1 | if ($calc($len(%c) + $len(%str)) <= $2) { var %str $+(%str,$chr($3),%c) } | else { break } | inc %x } | return $mid(%str,2) }
n78=;*****************************************************************************************************************************************************************************************************************************************************************
n79=alias -l Check.Settings {
n80=  if ($1 = Ep) || ($1 = Sch) {
n81=    if (%TV_Where == $null) || (%TV_Where2 == $null) { $iif($1 = Sch,set -u17 %TV_Where,set -u17 %TV_Where2) 0 }
n82=    if (%TV_Where == 1) || (%TV_Where2 == 1) { set -u17 %TVRage_Target. [ $+ [ $2 ] ] %TVRage_Chan. [ $+ [ $2 ] ] }
n83=    elseif (%TV_Where == 0) || (%TV_Where2 == 0) { set -u17 %TVRage_Target. [ $+ [ $2 ] ] %TVRage_Nick. [ $+ [ $2 ] ] } 
n84=    if (%TVRage_Query. [ $+ [ $2 ] ] == 1) { set -u17 %TVRage_Target. [ $+ [ $2 ] ] %TVRage_Nick. [ $+ [ $2 ] ] } 
n85=  }
n86=}
n87=alias -l CheckEP {
n88=  var %temp $GetTok($2-,$numtok($2-,32),32)
n89=  $iif(e isin %Temp,%Temp = $replace(%Temp,e,x))
n90=  set %Check_Season. [ $+ [ $1 ] ] $Mid(%Temp,1,$Calc($pos(%Temp,x)-1))
n91=  set %Check_EP. [ $+ [ $1 ] ] $Mid(%Temp,$Calc($pos(%Temp,x)+1))
n92=  if ($mid(%Check_Season. [ $+ [ $1 ] ],1,1) = s) { Set %Check_Season. [ $+ [ $1 ] ] $Mid(%Check_Season. [ $+ [ $1 ] ],2) }
n93=  if ((%Check_season. [ $+ [ $1 ] ] isnum) && (%Check_EP. [ $+ [ $1 ] ] isnum)) { Return 1 }
n94=  else { Return 0 }
n95=}
n96=alias -l msg {
n97=  if (%TV_Color = 0) { var %Temp = $strip($1-) | tokenize 32 %Temp }
n98=  if ($Show) { $iif($1 !ischan,!.msg $1 $iif(%TV_Color == 0,$strip($2-),$2-),!msg $1 $iif(c isincs $chan($1).mode,$strip($2-),$iif(%TV_Color == 0,$strip($2-),$2-))) } 
n99=  else { !.msg $1 $iif(c isincs $chan($1).mode,$strip($2-),$iif(%TV_Color == 0,$strip($2-),$2-)) }
n100=}
n101=on *:sockopen:TVRage.*: { var %num = $Mid($sockname,$calc($Pos($sockName,.,1) + 1))
n102=  if ($sockerr > 0) return 
n103=  ;**************************
n104=  elseif (%TVRage_Type. [ $+ [ %num ] ] == Schedule) || (%TVRage_Type. [ $+ [ %num ] ] == Country) { msg %TVRage_TargetC. [ $+ [ %num ] ] 5PM14'5iNG $+(13,%TVRage_Target. [ $+ [ %num ] ],) the program schedule for $+(3,%TVRage_Date. [ $+ [ %num ] ],) $+(15,$chr(40),7,$iif(%TVRage_Country. [ $+ [ %num ] ],$v1,US),$iif(%TVRage_Time_Schedule. [ $+ [ %num ] ],$+($chr(32),14-4#14-) $+(15,$v1) 14PM),15,$chr(41),) | sockwrite -n $SockName GET $+(/tools/quickschedule.php,$iif(%TVRage_Type. [ $+ [ %num ] ] == Country,$+(?country=,%TVRage_Country. [ $+ [ %num ] ]))) HTTP/1.1 }
n105=  ;*******************************************************************************************************
n106=  elseif (%TVRage_ONLY. [ $+ [ %num ] ] == SHOW) && (%show_ID. [ $+ [ %num ] ] != $null) { if (!%show_ID. [ $+ [ %num ] ]) { echo -at Sorry... unknown error... this option might not be implemented anymore | halt } | set %show_ID+. [ $+ [ %num ] ] %show_ID. [ $+ [ %num ] ] | sockwrite -n $sockname GET $+(/myfeeds/showinfo.php?key=sqsTSaJG4qJagM6ldpKZ&sid=,%show_ID+. [ $+ [ %num ] ]) HTTP/1.1 }
n107=  ;****************************************************************************************
n108=  elseif ((%TVRage_Type. [ $+ [ %num ] ] == SHOW) || (%TVRage_Type. [ $+ [ %num ] ] = EP) || (%TVRage_Type. [ $+ [ %num ] ] = EPSpec)) { sockwrite -n $sockname GET $+(/tools/quickinfo.php?show=,%tvshow. [ $+ [ %num ] ]) HTTP/1.0 }
n109=  ;************************************
n110=  set %TVRage_Day. [ $+ [ %num ] ] 0
n111=  ;************************************
n112=  sockwrite -n $sockname Host: $iif(%HOST,$v1,services.tvrage.com)
n113=  sockwrite -n $sockname Connection: keep-alive
n114=  sockwrite $sockname $crlf
n115=}
n116=on *:sockread:TVRage.*: { var %num = $Mid($sockname,$calc($Pos($sockName,.,1) + 1))
n117=  if ($sockerr) { return }
n118=  var %TVRead | sockread %TVRead
n119=  ;************************************************************************************************************************************
n120=  if (*Accept-Ranges:* iswm %TVRead) || (*X-Src-Webcache:* iswm %TVRead) || (*Connection:* iswm %TVRead) || (*TCN:* iswm %TVRead) || (*Content-Type:* iswm %TVRead) || (*Keep-Alive:* iswm %TVRead) || (*Date:* iswm %TVRead) || (*Server:* iswm %TVRead) || (*X-Powered-By:* iswm %TVRead) || (*Vary:* iswm %TVRead) || (*Content-Length:* iswm %TVRead) || (*Expires:* iswm %TVRead) || (*Cache-Control:* iswm %TVRead) || (*Pragma:* iswm %TVRead) || (*Set-Cookie:* iswm %TVRead) || (*Transfer-Encoding:* iswm %TVRead) || (*HTTP/1.1 200 OK* iswm %TVRead) || (*HTTP/1.1 501 Invalid Request* iswm %TVRead) || (*HTTP/1.1 404* iswm %TVRead) { $iif(*HTTP/1.1 404* iswm %TVRead,$iif(%TVRage_Target. [ $+ [ %num ] ],msg $v1,echo -at) $remove(%TVRead,HTTP/1.1 404),$iif(*HTTP/1.1 501 Invalid Request* iswm %TVRead,$iif(%TVRage_Target. [ $+ [ %num ] ],msg $v1,echo -at) Sorry... bad request... try again)) | $iif(*HTTP/1.1 404* iswm %TVRead,sockclose $sockname,$iif(*HTTP/1.1 501 Invalid Request* iswm %TVRead,sockclose $sockname)) | return }
n121=  ;*** Testing
n122=  ;  $iif(%TVRead != $null,echo -at $+(5,$replace($remove($v1,<pre>),@,15@14)))
n123=  ;***********************************************************************************
n124=  ;*** Show summary
n125=  if (%show_ID+. [ $+ [ %num ] ]) {
n126=    if (<image> isin %TVRead) { set %show_PiC [ $+ [ %num ] ] $nohtml(%TVRead) }
n127=    elseif (<summary> isin %TVRead) { %X = $replaceLiNK($remove(%TVRead,<summary>,	)) | $iif(*</summary>* iswm %TVRead,set %X $mid(%X,1,$calc($pos(%X,</summary>) -1))) | write tvrage.txt %X | unset %X }
n128=    elseif ($regex(%TVRead,<[^<>]+>) == 0) { $iif(%TVRead != $null,write tvrage.txt $replaceLiNK($v1)) }
n129=    if (</summary> isin %TVRead) { sockclose $sockname | $iif(%TVRage_Target. [ $+ [ %num ] ],msg $v1,echo -at) [ $+(05,%show_name. [ $+ [ %num ] ]) ] $iif(%show_Ended. [ $+ [ %num ] ] != $null,$+(,%show_Status. [ $+ [ %num ] ],) 14-4#14- $LongTime+($calc($cTime -$cTime($SetMonth(%show_Ended. [ $+ [ %num ] ])))) ago $+($chr(40),15,$replace(%show_Ended. [ $+ [ %num ] ],/,14/15),,$chr(41)),$iif(%show_Airtime. [ $+ [ %num ] ],$+(4,$v1,))) $iif(%show_Class. [ $+ [ %num ] ],$+(,$chr(40),15,$v1,,$chr(41),)) $iif(%show_Genre. [ $+ [ %num ] ],$+(14,$replace($v1,|,15/14),)) $iif(!%show_Ended. [ $+ [ %num ] ],since,from) $+(7,%show_Started. [ $+ [ %num ] ],$iif($len(%show_Ended. [ $+ [ %num ] ]) == 11 && %show_Started. [ $+ [ %num ] ] !isin %show_Ended. [ $+ [ %num ] ],$+(14-07,$gettok($v2,3,47))),) $iif(!%show_Ended. [ $+ [ %num ] ],$+(,$chr(40),%show_Status. [ $+ [ %num ] ],,$chr(41),)) $iif(%show_Network. [ $+ [ %num ] ] != $null,$iif(!%show_Ended. [ $+ [ %num ] ],airs,aired) on $+(7,$iif(%show_Country. [ $+ [ %num ] ] !isin %show_Network. [ $+ [ %num ] ],$v2 $+(15,$chr(40),07,$v1,15,$chr(41)),$replace($v2,$chr(40),$+(15,$chr(40),07),$chr(41),$+(15,$chr(41)))),)) $iif(%Show_link. [ $+ [ %num ] ],$+(15,$chr(40),2,$v1,15,$chr(41),))) $iif(%show_PiC [ $+ [ %num ] ],5Show images: $+(2,$v1,))
n130=    if ($lines(tvrage.txt) >= 1) { var %x 1 | while (%x <= $lines(tvrage.txt)) { $iif(%TVRage_Target. [ $+ [ %num ] ],$iif($lines(tvrage.txt) <= 1,mCuttext %TVRage_Target. [ $+ [ %num ] ],mCuttextN %TVRage_Nick. [ $+ [ %num ] ]),echo -at) $iif(%x == 1,5Description:) $read(tvrage.txt,%x) | inc %x } | .remove tvrage.txt } | goto ENDiTNOW }
n131=    return
n132=  }
n133=  ;************************************************************************************************************************************
n134=  ;*** Schedule
n135=  elseif (%TVRage_Type. [ $+ [ %num ] ] = Schedule) || (%TVRage_Type. [ $+ [ %num ] ] = Country) {
n136=    ;*** DAY
n137=    if ($mid(%TVRead,1,5) = [DAY]) { if ($Fopen(%TVRage_Day. [ $+ [ %num ] ])) { .fclose %TVRage_Day. [ $+ [ %num ] ] } | set -u17 %TVRage_Day. [ $+ [ %num ] ] $GetTok($Mid(%TVRead,6,$calc($pos(%TVRead,[/,1) - 6)),1,44) | if (%TVRage_Day. [ $+ [ %num ] ] = %TVRage_Date. [ $+ [ %num ] ]) { .fopen -no %TVRage_Day. [ $+ [ %num ] ] [ %TVRage_Day. [ $+ [ %num ] ] ] [ $+ [ %num ] ] $+ .txt | .fwrite -n %TVRage_Day. [ $+ [ %num ] ] $Mid(%TVRead,6,$calc($pos(%TVRead,[/,1) - 6)) } }
n138=    ;*** TiME
n139=    if ($regex(%TVRead,/\[TIME\](.*)\[\/TIME\]/i)) { set -u7 %sTiME $ascTime($cTime($date $regml(1)),HH:nn) }
n140=    ;*** SHOW
n141=    if ($regex(%TVRead,/\[SHOW\](.*)\[\/SHOW\]/i)) && (%TVRage_Day. [ $+ [ %num ] ] = %TVRage_Date. [ $+ [ %num ] ]) { set -u2 %TVRead_NetW $strip($remove($mid(%TVRead,$pos(%TVRead,]),$calc($pos(%TVRead,^,1) -$pos(%TVRead,],1))),])) | set -u2 %TVRead_TiTLE $strip($remove($mid(%TVRead,$pos(%TVRead,^,1),$calc($pos(%TVRead,^,2) -$pos(%TVRead,^,1))),^)) | set -u2 %TVRead_EP $strip($remove($mid(%TVRead,$pos(%TVRead,^,2),$calc($pos(%TVRead,^,3) -$pos(%TVRead,^,2))),^)) | set -u2 %TVRead_LiNK $strip($remove($mid(%TVRead,$pos(%TVRead,^,3),$calc($pos(%TVRead,[,2) -$pos(%TVRead,^,3))),^)) | set -u2 %TVRead_SHOW $+(4,[14,%sTiME,4]) $+(15,%TVRead_TiTLE,) 14-4#14- $+(14,$replace(%TVRead_EP,x,15x14),) 14-4#14- $+(8,%TVRead_NetW,) $+(,$chr(40),2,%TVRead_LiNK,,$chr(41),) | .fwrite -n %TVRage_Day. [ $+ [ %num ] ] %TVRead_SHOW }
n142=    return
n143=  }
n144=  if (!$sockbr) return
n145=  ;************************************************************************************************************************************
n146=  ;*** !TV / !EP / !SHOW / !NEXT / !N / !LAST / !L
n147=  elseif ($regex($strip(%TVRead),/Show ID@(.*)/)) { set %show_ID. [ $+ [ %num ] ] $regml(1) }
n148=  elseif ($regex($strip(%TVRead),/Show Name@(.*)/)) { set %show_Name. [ $+ [ %num ] ] $regml(1) }
n149=  elseif ($regex($strip(%TVRead),/Show URL@(.*)/)) { set %show_Link. [ $+ [ %num ] ] $remove($regml(1),http://) }
n150=  elseif ($regex($strip(%TVRead),/Premiered@(.*)/)) { set %show_Started. [ $+ [ %num ] ] $regml(1) }
n151=  elseif ($regex($strip(%TVRead),/Started@(.*)/)) { set %show_Started+. [ $+ [ %num ] ] $regml(1) }
n152=  elseif ($regex($strip(%TVRead),/Ended@(.*)/)) { set %show_Ended. [ $+ [ %num ] ] $regml(1) }
n153=  ;  elseif ($regex($strip(%TVRead),/Episode Info@(.*)/)) { set %show_EP. [ $+ [ %num ] ] $regml(1) }
n154=  elseif ($regex($strip(%TVRead),/Episode URL@(.*)/)) { set %show_URL. [ $+ [ %num ] ] $remove($regml(1),http://) }
n155=  ;  elseif ($regex($strip(%TVRead),/Latest Episode@(.*)/)) { set %show_Last. [ $+ [ %num ] ] $regml(1) }
n156=  ;  elseif ($regex($strip(%TVRead),/Next Episode@(.*)/)) { set %show_Next. [ $+ [ %num ] ] $regml(1) }
n157=  elseif ($regex($strip(%TVRead),/RFC3339@(.*)/)) { set %show_RFC. [ $+ [ %num ] ] $regml(1) }
n158=  elseif ($regex($strip(%TVRead),/GMT+0 NODST@(.*)/)) { set %show_GMT. [ $+ [ %num ] ] $regml(1) }
n159=  ;* ^ set %tvr.airnextepcmt $calc($gettok($regml(1),2,64) - $ctime + 3600) | echo -at %tvr.airnextepcmt vs $calc($gettok(%show_GMT. [ $+ [ %num ] ],2,64) - $ctime + 3600)
n160=  elseif ($regex($strip(%TVRead),/Country@(.*)/)) { set %show_Country. [ $+ [ %num ] ] $regml(1) }
n161=  elseif ($regex($strip(%TVRead),/Status@(.*)/)) { set %show_Status. [ $+ [ %num ] ] $replace($regml(1),Return,9Return,Final,3Final,Canceled/Ended,4Canceled,New,8New) }
n162=  elseif ($regex($strip(%TVRead),/Classification@(.*)/)) { set %show_Class. [ $+ [ %num ] ] $regml(1) }
n163=  elseif ($regex($strip(%TVRead),/Genres@(.*)/)) { set %show_Genre. [ $+ [ %num ] ] $regml(1) }
n164=  elseif ($regex($strip(%TVRead),/Network@(.*)/)) { set %show_Network. [ $+ [ %num ] ] $regml(1) }
n165=  ;  elseif ($regex($strip(%TVRead),/Airtime@(.*)/)) { set %show_Airtime. [ $+ [ %num ] ] $replace($regml(1),day,days,pm,PM,am,AM) }
n166=  ;  elseif ($regex($strip(%TVRead),/Runtime@(.*)/)) { set %show_Runtime. [ $+ [ %num ] ] $regml(1) }
n167=  ;************************************************************************************************************************************
n168=  ;*** Episode iNFO
n169=  elseif ($regex($strip(%TVRead),/Episode Info@(.*)/)) { set %show_EP. [ $+ [ %num ] ] $regml(1) | set -u3 %TVRead+ $gettok(%TVRead,2,64) | set -u3 %TVRead_DATE $gettok(%TVRead+,3,94) | set %TVRead_EP $gettok(%TVRead+,1,94) | set %TVRead_TiTLE $gettok(%TVRead+,2,94) | set %show_Spec. [ $+ [ %num ] ] $+(14,$replace(%TVRead_EP,x,15x14)) $iif(%TVRead_TiTLE,14-4#14- $+(15,$v1)) | set %show_Spec_Title. [ $+ [ %num ] ] %TVRead_TiTLE | set %show_Spec_EP. [ $+ [ %num ] ] %TVRead_EP | set %show_Spec_Airdate. [ $+ [ %num ] ] %TVRead_DATE | set %show_Spec_Airdate+. [ $+ [ %num ] ] $replace(%show_Spec_Airdate. [ $+ [ %num ] ],Jan,01,Feb,02,Mar,03,Apr,04,May,05,Jun,06,Jul,07,Aug,08,Sep,09,Oct,10,Nov,11,Dec,12) }
n170=  ;**********************************************************************************************************************************
n171=  ;*** Last + Next
n172=  elseif ($regex($strip(%TVRead),/Latest Episode@(.*)/)) || ($regex($strip(%TVRead),/Next Episode@(.*)/)) { set -u3 %TVRead+ $gettok(%TVRead,2,64) | set -u3 %TVRead_DATE $gettok(%TVRead+,3,94) | set -u3 %TVRead_EP $gettok(%TVRead+,1,94) | set -u3 %TVRead_TiTLE $gettok(%TVRead+,2,94) | $iif(Latest Episode@ isin %TVRead,set %show_Last. [ $+ [ %num ] ],set %show_Next. [ $+ [ %num ] ]) $+(14,$replace(%TVRead_EP,x,15x14)) $iif(%TVRead_TiTLE,14-4#14- $+(15,$v1)) | $iif(Latest Episode@ isin %TVRead,set %show_Last_Title. [ $+ [ %num ] ],set %show_Next_Title. [ $+ [ %num ] ]) %TVRead_TiTLE | $iif(Latest Episode@ isin %TVRead,set %show_Last_EP. [ $+ [ %num ] ],set %show_Next_EP. [ $+ [ %num ] ]) %TVRead_EP | $iif(Latest Episode@ isin %TVRead,set %show_Last_Airdate. [ $+ [ %num ] ],set %show_Next_Airdate. [ $+ [ %num ] ]) $+($GetTok(%TVRead_DATE,2,47),/,$GetTok(%TVRead_DATE,1,47),/,$GetTok(%TVRead_DATE,3,47)) | $iif(Latest Episode@ isin %TVRead,set %show_Last_Airdate+. [ $+ [ %num ] ],set %show_Next_Airdate+. [ $+ [ %num ] ]) $replace($iif(Latest Episode@ isin %TVRead,%show_Last_Airdate. [ $+ [ %num ] ],%show_Next_Airdate. [ $+ [ %num ] ]),Jan,01,Feb,02,Mar,03,Apr,04,May,05,Jun,06,Jul,07,Aug,08,Sep,09,Oct,10,Nov,11,Dec,12)) | $iif(%show_Ended. [ $+ [ %num ] ] != $null,$iif(Latest Episode@ isin %TVRead && $len(%show_Ended. [ $+ [ %num ] ]) >= 11,set %show_Ended. [ $+ [ %num ] ] $+($gettok(%show_Ended. [ $+ [ %num ] ],2,47),/,$gettok(%show_Ended. [ $+ [ %num ] ],1,47),/,$gettok(%show_Ended. [ $+ [ %num ] ],3,47)),set %show_Ended. [ $+ [ %num ] ] %show_Last_Airdate. [ $+ [ %num ] ]),unset %show_Ended. [ $+ [ %num ] ]) }
n173=  ;**********************************************************************************************************************************
n174=  ;*** Airtime (cTime)
n175=  elseif ($regex($strip(%TVRead),/Airtime@(.*)/)) { set %show_Airtime. [ $+ [ %num ] ] $replace($regml(1),day,days,pm,PM,am,AM) | $iif(%show_Spec_Airdate+. [ $+ [ %num ] ],set %show_Spec_cTime. [ $+ [ %num ] ] $cTime($v1 $GetTok(%Show_Airtime. [ $+ [ %num ] ],3-4,32))) | $iif(%show_Last_Airdate+. [ $+ [ %num ] ],set %show_Last_cTime. [ $+ [ %num ] ] $cTime($v1 $GetTok(%Show_Airtime. [ $+ [ %num ] ],3-4,32))) | $iif(%show_Next_Airdate+. [ $+ [ %num ] ],set %show_Next_cTime. [ $+ [ %num ] ] $cTime($v1 $GetTok(%Show_Airtime. [ $+ [ %num ] ],3-4,32))) }
n176=  ;**********************************************************************************************************************************
n177=  ;*** Runtime ( sockclose )
n178=  elseif ($regex($strip(%TVRead),/Runtime@(.*)/)) { set %show_Runtime. [ $+ [ %num ] ] $regml(1) | sockclose $sockname | Check.Settings Ep %Num
n179=    ;*** !SHOW
n180=    if (%TVRage_ONLY. [ $+ [ %num ] ] == SHOW) && (%show_ID. [ $+ [ %num ] ]) { $iif(%show_ID. [ $+ [ %num ] ] != $null,TVRage %num $v1) | halt }
n181=    ;**********************************************************************************************************************************
n182=    ;*** ERROR - $iif(%show_Last_Airdate+. [ $+ [ %num ] ],$+($chr(40),15,$replace($v1,/,14/15),,$chr(41))))
n183=    elseif (!%show_Next. [ $+ [ %num ] ]) && (%TVRage_ONLY. [ $+ [ %num ] ] == NEXT) { goto TVRage_iNFO }
n184=    elseif (!%show_Next. [ $+ [ %num ] ]) && (%TVRage_ONLY. [ $+ [ %num ] ] == NEXT) { msg %TVRage_Target. [ $+ [ %num ] ] No information available for $+(5,%show_name. [ $+ [ %num ] ],) $+(15,$chr(40),14,$left(%show_Last_EP. [ $+ [ %num ] ],2),15x14,$calc($mid(%show_Last_EP. [ $+ [ %num ] ],4,2) +1),15,$chr(41),) 14-4#14- 5Reason: $iif(!%show_Ended. [ $+ [ %num ] ],Unknown... might not be schedule yet $+(15,$chr(40),%show_Status. [ $+ [ %num ] ],15,$chr(41),),$iif(%show_Last_cTime. [ $+ [ %num ] ],The show sadly ended $+(15,$replacex($duration($calc($cTime -$v1)),wks,14weeks15,wk,14week15,days,14days15,day,14day15,hrs,14hours15,hr,14hour15,mins,14minutes15,min,14minute,secs,14seconds,sec,14second) 14ago),Sadly this show has either ended or been canceled)) $iif(%Show_link. [ $+ [ %num ] ],$+(15,$chr(40),2,$v1,15,$chr(41),)) | goto ENDiTNOW }
n185=    elseif (%TVRage_Type. [ $+ [ %num ] ] == EPSpec) && ((%Check_Season. [ $+ [ %num ] ]) || (%Check_EP. [ $+ [ %num ] ])) && (!%show_Spec_EP. [ $+ [ %num ] ]) { msg %TVRage_Target. [ $+ [ %num ] ] No information available for $+(5,%show_name. [ $+ [ %num ] ],) $+(15,$chr(40),14,$iif($len(%Check_Season. [ $+ [ %num ] ]) == 1,0),%Check_Season. [ $+ [ %num ] ],15x14,$iif($len(%Check_EP. [ $+ [ %num ] ]) == 1,0),%Check_EP. [ $+ [ %num ] ],15,$chr(41),) 14-4#14- 5Reason: Not that many episodes in the $+(14,$ord(%Check_Season. [ $+ [ %num ] ]),) season $iif(%Show_link. [ $+ [ %num ] ],$+(15,$chr(40),2,$v1,/episode_list/,%Check_Season. [ $+ [ %num ] ],15,$chr(41),)) | goto ENDiTNOW }
n186=    ;**********************************************************************************************************************************
n187=    ;*** EPSpecs
n188=    elseif (%show_Spec_EP. [ $+ [ %num ] ] != $null) { msg %TVRage_Target. [ $+ [ %num ] ] $+(05,%show_name. [ $+ [ %num ] ],) 14-4#14- %show_Spec. [ $+ [ %num ] ] $iif(%show_Spec_cTime. [ $+ [ %num ] ] > $cTime,5Airing in:,5Aired:) $iif(%show_Spec_cTime. [ $+ [ %num ] ] != $null,$LongTime+($calc($cTime -$cTime(%show_Spec_Airdate+. [ $+ [ %num ] ])))) $iif(%show_Spec_cTime. [ $+ [ %num ] ] < $cTime,ago) $+($chr(40),15,$replace(%show_Spec_Airdate+. [ $+ [ %num ] ],/,14/15),,$chr(41)) $iif(%show_URL. [ $+ [ %num ] ] != $null,$+(15,$chr(40),2,$v1,15,$chr(41),))) | $iif(%show_URL. [ $+ [ %num ] ] != $null,TVPlot %TVRage_Target. [ $+ [ %num ] ] %show_URL. [ $+ [ %num ] ]) | goto ENDiTNOW }
n189=    ;*** SHOW iNFO / MSG
n190=    elseif (!%TVRage_ONLY. [ $+ [ %num ] ]) { :TVRage_iNFO | $iif(%TVRage_Target. [ $+ [ %num ] ],msg $v1,echo -at) [ $+(05,%show_name. [ $+ [ %num ] ]) ] $iif(%show_Ended. [ $+ [ %num ] ] != $null,Ended and/or canceled 14-4#14- $LongTime+($calc($cTime -$cTime($SetMonth(%show_Ended. [ $+ [ %num ] ])))) ago $+($chr(40),15,$replace(%show_Ended. [ $+ [ %num ] ],/,14/15),,$chr(41)),$iif(%show_Airtime. [ $+ [ %num ] ],$+(4,$v1,))) $iif(%show_Class. [ $+ [ %num ] ],$+(,$chr(40),15,$v1,,$chr(41),)) $iif(%show_Genre. [ $+ [ %num ] ],$+(14,$replace($v1,|,15/14),)) $iif(!%show_Ended. [ $+ [ %num ] ],since,from) $+(7,%show_Started. [ $+ [ %num ] ],$iif($len(%show_Ended. [ $+ [ %num ] ]) == 11 && %show_Started. [ $+ [ %num ] ] !isin %show_Ended. [ $+ [ %num ] ],$+(14-07,$gettok($v2,3,47))),) $iif(!%show_Ended. [ $+ [ %num ] ],$+(,$chr(40),%show_Status. [ $+ [ %num ] ],,$chr(41),)) $iif(%show_Network. [ $+ [ %num ] ] != $null,$iif(!%show_Ended. [ $+ [ %num ] ],airs,aired) on $+(7,$iif(%show_Country. [ $+ [ %num ] ] !isin %show_Network. [ $+ [ %num ] ],$v2 $+(15,$chr(40),07,$v1,15,$chr(41)),$replace($v2,$chr(40),$+(15,$chr(40),07),$chr(41),$+(15,$chr(41)))),)) $iif(%Show_link. [ $+ [ %num ] ],$+(15,$chr(40),2,$v1,15,$chr(41),))) | $iif(!%show_Next. [ $+ [ %num ] ] && %TVRage_ONLY. [ $+ [ %num ] ] == NEXT,goto TVRage_LAST) }
n191=    ;*** !LAST
n192=    if ((!%TVRage_ONLY. [ $+ [ %num ] ]) || (%TVRage_ONLY. [ $+ [ %num ] ] == LAST)) && (%show_Last. [ $+ [ %num ] ] != $null) { :TVRage_LAST | msg %TVRage_Target. [ $+ [ %num ] ] $iif(%TVRage_ONLY. [ $+ [ %num ] ] == LAST,$+(5,%show_name. [ $+ [ %num ] ],) 14-4#14-,5Last Episode) %show_Last. [ $+ [ %num ] ] $iif(%show_Last_cTime. [ $+ [ %num ] ],5Aired: $+(15,$LongTime+($calc($cTime -$v1)) 14ago)) $iif(%show_Last_Airdate+. [ $+ [ %num ] ],$+($chr(40),15,$replace($v1,/,14/15),,$chr(41))) $iif(%TVRage_ONLY. [ $+ [ %num ] ] == LAST && %Show_link. [ $+ [ %num ] ] != $null,$+(15,$chr(40),2,%Show_link. [ $+ [ %num ] ],15,$chr(41),))) }
n193=    ;*** !NEXT
n194=    if (%show_Next. [ $+ [ %num ] ] != $null) && ((!%TVRage_ONLY. [ $+ [ %num ] ]) || (%TVRage_ONLY. [ $+ [ %num ] ] == NEXT)) { msg %TVRage_Target. [ $+ [ %num ] ] $iif(%TVRage_ONLY. [ $+ [ %num ] ] == NEXT,$+(5,%show_name. [ $+ [ %num ] ]) 14-4#14-,5Next Episode) $+(%show_Next. [ $+ [ %num ] ],) $iif(%show_Next_cTime. [ $+ [ %num ] ] > $cTime,5Airing in: $+($LongTime+($calc($v1 -$cTime)),),5Aired: $+($LongTime+($calc($cTime -$v1)),)) $iif(%show_Next_Airdate+. [ $+ [ %num ] ],$+($chr(40),15,$replace($v1,/,14/15),,$chr(41))) $iif(%TVRage_ONLY. [ $+ [ %num ] ] == NEXT && %Show_link. [ $+ [ %num ] ] != $null,$+(15,$chr(40),2,%Show_link. [ $+ [ %num ] ],15,$chr(41),)))) }
n195=    :ENDiTNOW
n196=    unset %TVRead* %tvshow* [ $+ [ %num ] ] %show_* [ $+ [ %num ] ] %TVRage_* [ $+ [ %num ] ] %Check_* [ $+ [ %num ] ] %next_* [ $+ [ %num ] ] %show_* [ $+ [ %num ] ]
n197=  }
n198=}
n199=on *:sockclose:TVRage.*:{ var %num = $Mid($sockname,$calc($Pos($sockName,.,1) + 1))
n200=  ;**** !TODAY / !TOMORROW ( As in program schedule )
n201=  if ((%TVRage_Type. [ $+ [ %num ] ] = Schedule) || (%TVRage_Type. [ $+ [ %num ] ] = Country)) { Check.Settings Sch %Num | if (%TVRage_Date. [ $+ [ %num ] ] != $null) { .fopen %TVRage_Date. [ $+ [ %num ] ] [ %TVRage_Date. [ $+ [ %num ] ] ] [ $+ [ %num ] ] $+ .txt | set -u17 %TVRage_DATE+ [ $+ [ %num ] ] $+(15,$fread(%TVRage_Date. [ $+ [ %num ] ])) | while ($Feof != 1) { set -u2 %TVRage_Tmp. [ $+ [ %num ] ] $Fread(%TVRage_Date. [ $+ [ %num ] ]) | set -u2 %TVRage_Time_Temp. [ $+ [ %num ] ] $remove(%TVRage_Tmp. [ $+ [ %num ] ],$GetTok(%TVRage_Tmp. [ $+ [ %num ] ],2,93),[,]) | if (!%NOTHiNGFOUD) { set -u17 %NOTHiNGFOUD 1 | .TiMER-TV-SCHEDULE 1 3 $iif(%TVRage_Target. [ $+ [ %num ] ],msg $v1,echo -at) [4ERROR] 14There are no new TV Shows Scheduled for $+(04,%TVRage_Time_Schedule. [ $+ [ %num ] ],15:0400 $iif(%TVRage_Time_Schedule. [ $+ [ %num ] ] < 12,14PM,14AM),) } | if (%TVRage_Time_Schedule. [ $+ [ %num ] ] == $null) || ((%TVRage_Time_Schedule. [ $+ [ %num ] ] != $null) && ($mid($strip(%TVRage_Time_Temp. [ $+ [ %num ] ]),1,2) == $int($replacex($mid(%TVRage_Time_Schedule. [ $+ [ %num ] ],1,2),5,17,6,18,7,19,8,20,9,21,10,22,11,23,12,00)))) { .TiMER-TV-SCHEDULE OFF | $iif(%NOTHiNGFOUD == 1,$iif(%TVRage_Target. [ $+ [ %num ] ],.msg $v1,echo -at) 05Schedule for %TVRage_DATE+ [ $+ [ %num ] ] $iif(%TVRage_Time_Schedule. [ $+ [ %num ] ],5at $+(15,$replacexcs($v1,5,17,6,18,7,19,8,20,9,21,10,22,11,23,12,00),14:1500) $iif($replacexcs(%TVRage_Time_Schedule. [ $+ [ %num ] ],5,17,6,18,7,19,8,20,9,21,10,22,11,23,12,00) > 12,14PM,14AM))) | $iif(%TVRage_Target. [ $+ [ %num ] ],.msg $v1,echo -at) $replaceLiNK(%TVRage_Tmp. [ $+ [ %num ] ]) | inc -u3 %NOTHiNGFOUD } } } | .fclose %TVRage_Date. [ $+ [ %num ] ] | .remove [ %TVRage_Date. [ $+ [ %num ] ] ] [ $+ [ %num ] ] $+ .txt }
n202=  .unset %tvshow* [ $+ [ %num ] ] %show_* [ $+ [ %num ] ] %TVRage_* [ $+ [ %num ] ] %Check_* [ $+ [ %num ] ] %next_* [ $+ [ %num ] ]
n203=}
n204=;**********************************************************************************************************************************
n205=;*** TVPlot
n206=alias TVPlot { set -u5 %CHAN $1 | $iif($2,set %TVPlot-Link $remove($2,www.tvrage.com,http://)) | sockClose TVPlot | sockOpen TVPlot www.tvrage.com 80 } 
n207=on *:SockOpen:TVPlot: { sockwrite -nt TVPlot GET $iif(%TVPlot-Link,$v1,/House/episodes/1064858782) HTTP/1.1 | sockwrite -nt TVPlot Host: www.tvrage.com | sockwrite -nt TVPlot $crlf | unset %TVPlot-Link }
n208=on *:SockRead:TVPlot: { tokenize 32 $sock($sockname).mark | var %read | sockRead %read | if (<span class="addthis_toolbox addthis_default_style "> isin %read) { set -u1 %Plot $noHTML($v2) | $iif(Source: isin %Plot,set -u1 %Plot $mid($noHTML(%read),1,$pos($noHTML(%read),.Source:))) | $iif(%Plot != $null,$iif(%CHAN,mCuttext $v1,echo -at) 5Summary: $iif(Click Here To Add isin %Plot,Not availible for this episode,%Plot)) } }
n209=;**********************************************************************************************************************************
n210=;*** Dialog section
n211=dialog -l TVSettings {
n212=  title "TVRage Settings"
n213=  size -1 -1 264 217
n214=  option pixels
n215=  box "", 1, 8 8 249 60
n216=  box "", 2, 8 67 249 60
n217=  box "", 3, 8 126 249 43
n218=  box "", 12, 8 168 249 43
n219=  text "Select where you want the Schedule Displayed", 4, 16 21 225 17
n220=  radio "Channel", 5, 32 45 65 13, group
n221=  radio "Private Message", 6, 128 45 105 13,
n222=  text "Select where you want the Replys Displayed", 7, 16 80 225 17
n223=  radio "Channel", 8, 32 104 65 13, group
n224=  radio "Private Message", 9, 128 104 105 13,
n225=  check "Enable TVRage", 10, 32 188 113 13
n226=  button "&Save Settings", 11, 144 182 89 25, ok
n227=  check "Enable Colors", 13, 32 145 113 13
n228=}
n229=on *:dialog:TVSettings:*:*:{
n230=  if ($Devent == init) {
n231=    if (%TV_Where = 1) { did -c $dname 8 }
n232=    else { did -c $dname 9 }
n233=    if (%TV_Where2 = 1) { did -c $dname 5 }
n234=    else { did -c $dname 6 }
n235=    if (%TV_Rage = 1) { did -c $dname 10 }
n236=    else { did -u $dname 10 }
n237=    if (%TV_Color = 1) { did -c $dname 13 }
n238=    else { did -u $dname 13 }
n239=  }
n240=  elseif ($devent == Close) {
n241=    set %TV_Where $iif($Did($Dname,8).state = 1,1,0)
n242=    set %TV_Where2 $iif($Did($Dname,5).state = 1,1,0)      
n243=    set %TV_Rage $iif($Did($Dname,10).state = 1,1,0)
n244=    set %TV_Color $iif($Did($Dname,13).state = 1,1,0)
n245=    echo -at 14TVRage Settings have been saved.
n246=  }
n247=}
n248=dialog -l SelfSearch {
n249=  title "TVRage Search"
n250=  size -1 -1 500 202
n251=  option pixels
n252=  box "", 1, 8 8 486 145
n253=  box "", 2, 8 152 486 43
n254=  text "Search Options:", 3, 16 16 462 17
n255=  text "<Show> (Season and Episode) EX: House 2x05", 4, 30 33 462 17
n256=  text "Schedule <Day of Week> EX: Schedule Fri", 5, 30 50 462 17
n257=  text "Schedule <Day of Week> (Time)  EX: Schedule Wed 10", 6, 30 67 462 17
n258=  text "Schedule <Day of Week> (Time) (Country:US,GB,UK,AU) EX: Schedule Saturday 10 GB", 7, 30 84 462 17
n259=  text "Option in ( ) are Optional. Options in < > are Required.", 8, 30 101 462 17
n260=  edit "", 9, 16 125 462 17, autohs 
n261=  button "Search", 10, 335 165 65 25
n262=  button "Cancel", 11, 414 165 65 25, cancel
n263=}
n264=on *:dialog:SelfSearch:sclick:*:{
n265=  if ($Did = 10) && ($Did(9) = $null) && ($dialog(error,error,-4)) { did -f $Dname 9 }
n266=  elseif ($Did = 10)  { var %Num = $trnum | set %TVRage_Target. [ $+ [ %num ] ] $me | set %TVRage_Nick. [ $+ [ %num ] ] $me | set %TVRage_Chan. [ $+ [ %num ] ] $me | TVRage.Load %num !ep $did(9).text | echo -at Check you Private Message for the infomation that you requested | dialog -x $dname }
n267=}
n268=dialog -l error {
n269=  title "Error"
n270=  size -1 -1 228 90
n271=  option pixels
n272=  box "", 2, 8 8 214 33 
n273=  box "", 3, 8 40 214 43
n274=  button "&Ok", 4, 160 52 50 25, ok
n275=  text "DOH! - You must type something to search for!", 5, 20 20 190 17
n276=}
n277=;*** END TVRage section ****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
